/* ====== ROOT FIX ====== */
:root {
  --bg: #0b0e14;
  --code-1: #ffd64f;
  --code-2: #ffe46b;
  --code-3: #fff5c7;
  --edit-0: #07080c;
  --edit-1: #0d1018;
  --radius: 18px;
  --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.12);
  --ease-out: cubic-bezier(0.18, 0.84, 0.26, 1);
  --ease-in: cubic-bezier(0.78, 0.12, 0.86, 0.28);
  --t-intro: 2800ms;
  --t-merge: 1200ms;
  --t-bloom: 1400ms;
  --t-reveal: 700ms;
}

* {
  box-sizing: border-box;
}
html,
body,
#root {
  width: 100%;
  height: 100%;
}

body {
  margin: 0;
  font-family:
    ui-sans-serif,
    system-ui,
    -apple-system,
    'Segoe UI',
    Roboto,
    'PingFang SC',
    'Hiragino Sans GB',
    'Microsoft YaHei',
    Arial,
    sans-serif;
  background: #0b0e14;
}

/* 首页保持一屏（stage 1~4） */
.app {
  width: 100%;
  height: 100vh;
  position: relative;
  isolation: isolate;
  background: var(--bg);
  color: rgba(255, 255, 255, 0.92);
  overflow: hidden;
}

/* stage-4：只要底色 + 空屏 */
.app.stage-4 {
  background:
    radial-gradient(1200px 700px at 50% 0%, var(--code-2), transparent 70%),
    linear-gradient(180deg, var(--code-3), rgba(255, 255, 255, 0.92));
  color: #141414;
}
.stage4-empty {
  position: absolute;
  inset: 0;
}

/* 分屏 */
.split {
  position: relative;
  height: 100vh;
  width: 100%;
  overflow: hidden;
}

.panel {
  position: absolute;
  inset: 0 auto 0 0;
  width: 50%;
  height: 100%;
  overflow: hidden;
}
.panel--right {
  inset: 0 0 0 auto;
}

.panel__bg {
  position: absolute;
  inset: -20%;
  transform: scale(1.1);
}
.panel__bg--edit {
  background:
    radial-gradient(
      1200px 800px at 20% 30%,
      rgba(120, 150, 255, 0.18),
      transparent 65%
    ),
    radial-gradient(
      800px 600px at 70% 70%,
      rgba(255, 255, 255, 0.06),
      transparent 60%
    ),
    linear-gradient(180deg, var(--edit-1), var(--edit-0));
}

.panel__label {
  position: absolute;
  left: clamp(16px, 4vw, 40px);
  bottom: clamp(18px, 4vw, 44px);
  display: flex;
  flex-direction: column;
  gap: 6px;
  mix-blend-mode: screen;
  z-index: 50;
}
/* 只让“攀岩”那组文案靠右 */
.panel__label--right {
  left: auto;
  right: clamp(16px, 4vw, 40px);
  text-align: right;
}

.panel__label .title {
  font-size: clamp(18px, 2.4vw, 28px);
  font-weight: 700;
  opacity: 0.96;
}

/* 中央线 */
.seam {
  position: absolute;
  top: 0;
  left: 50%;
  width: 1px;
  height: 100%;
  transform: translateX(-0.5px);
  z-index: 60;
  pointer-events: none;
}
.seam__line {
  position: absolute;
  inset: 0;
  background: rgba(255, 255, 255, 0.18);
  opacity: 0.45;
}
.seam__core {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 14px;
  height: 14px;
  transform: translate(-50%, -50%);
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.75);
  box-shadow:
    0 0 0 14px rgba(255, 255, 255, 0.08),
    0 0 40px rgba(255, 255, 255, 0.25);
  opacity: 0;
}

/* 左：攀岩 */
.climbPhoto {
  position: relative;
  width: 100%;
  height: 100%;
  background: #0b0e14;
}
.climbPhoto__img {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  transform: scale(1.1);
  filter: saturate(0.75) contrast(0.9) brightness(0.82);
}
.climbPhoto__veil {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      900px 700px at 30% 25%,
      rgba(255, 255, 255, 0.1),
      transparent 60%
    ),
    radial-gradient(
      900px 700px at 70% 70%,
      rgba(0, 0, 0, 0.55),
      transparent 62%
    ),
    linear-gradient(90deg, rgba(0, 0, 0, 0.38), rgba(0, 0, 0, 0.26));
  backdrop-filter: blur(6px);
  opacity: 0.75;
}

/* ✅ fallback：图片没出来也不会黑屏 */
.climbPhoto.is-fallback::before {
  content: '';
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      900px 700px at 30% 25%,
      rgba(255, 255, 255, 0.1),
      transparent 60%
    ),
    radial-gradient(
      900px 700px at 70% 70%,
      rgba(0, 0, 0, 0.45),
      transparent 62%
    ),
    linear-gradient(90deg, rgba(60, 90, 120, 0.28), rgba(0, 0, 0, 0.1));
}

/* 右：剪辑 */
.edit {
  position: relative;
  width: 100%;
  height: 100%;
}
.edit__vignette {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      800px 500px at 30% 40%,
      transparent,
      rgba(0, 0, 0, 0.55) 70%
    ),
    linear-gradient(
      90deg,
      rgba(0, 0, 0, 0.55),
      transparent 35%,
      transparent 65%,
      rgba(0, 0, 0, 0.3)
    );
  opacity: 0.75;
}

.edit__frames {
  position: relative;
  width: 100%;
  height: 100%;
}

.shot {
  position: absolute;
  border-radius: 14px;
  overflow: hidden;
  border: 1px solid rgba(255, 255, 255, 0.18);
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.25);
  background: rgba(255, 255, 255, 0.06);
  opacity: 0.92;
}
.shot__img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transform: scale(1.05);
  filter: saturate(0.9) contrast(0.92) brightness(0.82);
}
.shot__veil {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(
      800px 500px at 30% 20%,
      rgba(255, 255, 255, 0.1),
      transparent 62%
    ),
    linear-gradient(180deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.48));
  backdrop-filter: blur(4px);
  opacity: 0.75;
}

/* 三卡片 */
.shot.s1 {
  width: 40%;
  height: 30%;
  left: 12%;
  top: 14%;
  transform: rotate(-3deg);
}
.shot.s2 {
  width: 48%;
  height: 36%;
  left: 34%;
  top: 30%;
  transform: rotate(2deg);
  opacity: 0.78;
}
.shot.s3 {
  width: 34%;
  height: 24%;
  left: 18%;
  top: 54%;
  transform: rotate(-1deg);
  opacity: 0.68;
}

/* ✅ fallback */
.shot.is-fallback {
  background:
    radial-gradient(
      500px 280px at 30% 30%,
      rgba(255, 255, 255, 0.08),
      transparent 60%
    ),
    linear-gradient(180deg, rgba(255, 255, 255, 0.06), rgba(0, 0, 0, 0.28));
}

.edit__timeline {
  position: absolute;
  left: clamp(16px, 4vw, 40px);
  top: clamp(18px, 4vw, 44px);
  width: min(420px, 40vw);
  display: flex;
  flex-direction: column;
  gap: 10px;
  opacity: 0.9;
  z-index: 40;
}
.tl-row {
  height: 10px;
  display: flex;
  gap: 8px;
  opacity: 0.9;
}
.clip {
  display: inline-block;
  height: 100%;
  border-radius: 999px;
  background: rgba(255, 255, 255, 0.16);
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.05) inset;
}
.c1 {
  width: 22%;
}
.c2 {
  width: 12%;
  opacity: 0.55;
}
.c3 {
  width: 30%;
}
.c4 {
  width: 16%;
}
.c5 {
  width: 22%;
  opacity: 0.55;
}
.c6 {
  width: 10%;
}
.c7 {
  width: 18%;
}
.c8 {
  width: 28%;
  opacity: 0.65;
}
.c9 {
  width: 14%;
}
.c10 {
  width: 20%;
  opacity: 0.55;
}

.edit__playhead {
  position: absolute;
  left: clamp(16px, 4vw, 40px);
  top: calc(clamp(18px, 4vw, 44px) + 38px);
  width: min(420px, 40vw);
  height: 2px;
  z-index: 40;
}
.edit__playhead::before {
  content: '';
  position: absolute;
  left: 0;
  top: -18px;
  width: 2px;
  height: 56px;
  background: rgba(255, 255, 255, 0.55);
  box-shadow: 0 0 18px rgba(255, 255, 255, 0.25);
  animation: playhead 1.1s linear infinite;
  opacity: 0.75;
}
@keyframes playhead {
  0% {
    transform: translateX(0);
    opacity: 0.35;
  }
  40% {
    opacity: 0.9;
  }
  100% {
    transform: translateX(100%);
    opacity: 0.35;
  }
}

/* 编程扩散 */
.code-bloom {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 80;
  opacity: 0;
}
.bloom {
  position: absolute;
  left: 50%;
  top: 50%;
  width: 14px;
  height: 14px;
  transform: translate(-50%, -50%);
  border-radius: 999px;
  opacity: 0;
}
.bloom--1 {
  background: var(--code-1);
}
.bloom--2 {
  background: var(--code-2);
}
.bloom--3 {
  background: var(--code-3);
}

.grid-hint {
  position: absolute;
  inset: 0;
  opacity: 0;
  background-image:
    linear-gradient(to right, rgba(20, 20, 20, 0.12) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(20, 20, 20, 0.12) 1px, transparent 1px);
  background-size: 56px 56px;
  mix-blend-mode: multiply;
}
/* ===== Stage-3 typing layer (always centered) ===== */
.stage3Type {
  position: absolute;
  inset: 0;
  z-index: 120;
  display: grid;
  place-items: center; /* ✅ 从一开始就居中 */
  padding: 0 clamp(16px, 4vw, 44px);
  pointer-events: none;
}

/* 代码块视觉 */
.typeBlock {
  margin: 0;
  width: min(720px, 92vw);
  padding: 18px 18px;
  border-radius: 16px;
  background: rgba(255, 255, 255, 0.12);
  border: 1px solid rgba(255, 255, 255, 0.18);
  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.18);
  backdrop-filter: blur(8px);
  overflow: hidden;
}

.typeBlock code {
  display: block;
  white-space: pre;
  font-family:
    ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono',
    'Courier New', monospace;
  font-size: clamp(14px, 1.4vw, 16px);
  line-height: 1.6;
  color: rgba(20, 20, 20, 0.86);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.24);
}

/* 小屏防止溢出：允许横向滚动而不破坏代码缩进 */
@media (max-width: 520px) {
  .typeBlock {
    overflow-x: auto;
  }
}

/* 光标 */
.caret {
  display: inline-block;
  width: 10px;
  height: 1.05em;
  margin-left: 4px;
  transform: translateY(2px);
  border-radius: 2px;
  background: rgba(20, 20, 20, 0.68);
  animation: caretBlink 1s steps(1) infinite;
}
@keyframes caretBlink {
  0%,
  49% {
    opacity: 1;
  }
  50%,
  100% {
    opacity: 0;
  }
}

/* 左下角 quote（仅 stage-3 渲染时存在） */
.stage3Quote {
  position: absolute;
  left: clamp(16px, 4vw, 40px);
  bottom: clamp(16px, 4vw, 36px);
  z-index: 130;
  pointer-events: none;
  font-family:
    ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono',
    'Courier New', monospace;
  font-size: 13px;
  line-height: 1.35;
  color: rgba(20, 20, 20, 0.72);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.22);
  opacity: 0.95;
}
/* ===== IDE shell for stage-3 typing ===== */

.ide {
  width: min(760px, 92vw);
  border-radius: 18px;
  background: rgba(255, 255, 255, 0.14);
  border: 1px solid rgba(255, 255, 255, 0.18);
  box-shadow: 0 22px 60px rgba(0, 0, 0, 0.18);
  backdrop-filter: blur(10px);
  overflow: hidden;
}

/* 顶部栏 */
.ide__top {
  height: 40px;
  display: grid;
  grid-template-columns: 92px 1fr 92px;
  align-items: center;
  padding: 0 12px;
  background: rgba(255, 255, 255, 0.1);
  border-bottom: 1px solid rgba(255, 255, 255, 0.14);
}

/* 左侧三个圆点 */
.ide__dots {
  display: inline-flex;
  align-items: center;
  gap: 8px;
}
.dot {
  width: 10px;
  height: 10px;
  border-radius: 999px;
  background: rgba(20, 20, 20, 0.28);
  box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.16) inset;
}
.dot.d2 {
  opacity: 0.75;
}
.dot.d3 {
  opacity: 0.55;
}

/* 中间标题 */
.ide__title {
  justify-self: center;
  font-family:
    ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono',
    'Courier New', monospace;
  font-size: 12px;
  letter-spacing: 0.06em;
  color: rgba(20, 20, 20, 0.62);
  text-shadow: 0 1px 0 rgba(255, 255, 255, 0.24);
}

/* 让 pre 贴合 IDE 外壳，而不是自己再单独画一层边框 */
.ide .typeBlock {
  width: 100%;
  border: none;
  box-shadow: none;
  border-radius: 0;
  background: transparent;
  backdrop-filter: none;
  padding: 16px 18px 18px;
}

/* 阶段控制 */
.app.stage-1 .panel--left {
  transform: translateX(-6%);
}
.app.stage-1 .panel--right {
  transform: translateX(6%);
}
.app.stage-1 .panel--left,
.app.stage-1 .panel--right {
  transition: transform var(--t-intro) var(--ease-out);
}
.app.stage-1.is-running .panel--left {
  transform: translateX(0);
}
.app.stage-1.is-running .panel--right {
  transform: translateX(0);
}

.app.stage-2 .panel--left {
  transform: translateX(2.5%);
}
.app.stage-2 .panel--right {
  transform: translateX(-2.5%);
}
.app.stage-2 .panel--left,
.app.stage-2 .panel--right {
  transition: transform var(--t-merge) var(--ease-in);
}
.app.stage-2 .seam__core {
  opacity: 1;
  transition: opacity 380ms var(--ease-out);
}

.app.stage-3 .code-bloom {
  opacity: 1;
  transition: opacity 200ms linear;
}
.app.stage-3 .bloom {
  opacity: 1;
  animation: bloom var(--t-bloom) var(--ease-out) forwards;
}
.app.stage-3 .bloom--1 {
  animation-delay: 0ms;
}
.app.stage-3 .bloom--2 {
  animation-delay: 80ms;
}
.app.stage-3 .bloom--3 {
  animation-delay: 160ms;
}

.app.stage-3 .grid-hint {
  opacity: 0.9;
  transition: opacity var(--t-bloom) var(--ease-out);
}

@keyframes bloom {
  0% {
    transform: translate(-50%, -50%) scale(1);
    filter: blur(0px);
  }
  100% {
    transform: translate(-50%, -50%) scale(220);
    filter: blur(0.6px);
  }
}
.app.stage-3 .split,
.app.stage-4 .split {
  opacity: 0;
  transform: scale(1.02);
  transition:
    opacity 520ms var(--ease-out),
    transform 520ms var(--ease-out);
  pointer-events: none;
}
.app.stage-4 .code-bloom {
  opacity: 0;
  transition: opacity 420ms var(--ease-out);
}
.app.stage-4 .panel__label {
  opacity: 0;
}

/* 卡片浮动 */
.app.stage-1 .shot,
.app.stage-2 .shot {
  animation: floaty 3.4s var(--ease-out) infinite alternate;
}
@keyframes floaty {
  0% {
    transform: translateY(0) rotate(var(--r, 0deg));
  }
  100% {
    transform: translateY(-10px) rotate(var(--r, 0deg));
  }
}
.shot.s1 {
  --r: -3deg;
}
.shot.s2 {
  --r: 2deg;
}
.shot.s3 {
  --r: -1deg;
}

/* 手机端 */
@media (max-width: 720px) {
  .panel {
    width: 100%;
    height: 50%;
  }
  .panel--right {
    inset: auto 0 0 0;
  }
  .seam {
    left: 0;
    top: 50%;
    width: 100%;
    height: 1px;
    transform: translateY(-0.5px);
  }
  .app.stage-1 .panel--left {
    transform: translateY(-6%);
  }
  .app.stage-1 .panel--right {
    transform: translateY(6%);
  }
  .app.stage-1.is-running .panel--left,
  .app.stage-1.is-running .panel--right {
    transform: translateY(0);
  }
  .app.stage-2 .panel--left {
    transform: translateY(2.5%);
  }
  .app.stage-2 .panel--right {
    transform: translateY(-2.5%);
  }
  .panel--left .panel__label--right {
    right: 14px;
    left: 14px;
    text-align: right;
    align-items: flex-end;
  }
  .panel--left .panel__label--right .title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .app {
    --m-seam-offset: 18px;
  }

  .panel--left .panel__label {
    bottom: var(--m-seam-offset);
  }

  .panel--right .panel__label {
    top: var(--m-seam-offset);
    bottom: auto;
    left: 14px;
    right: auto;
  }
  .shot.s1 {
    top: 22%;
  }
  .shot.s2 {
    top: 40%;
  }
  .shot.s3 {
    top: 64%;
  }
}
